# 前端开发计划（V1）

本计划基于当前 `vue-web/` 代码与《设计与开发方案》《前端页面交互与样式设计》《开发计划》对照梳理，明确需要新增/修改的点，并列出实施清单。

## 0. 现状对比（delta）
- 已有：Vite + Vue3 + Tailwind；基础路由（Home/About/NotFound）；导航与示例页面。
- 缺失：
  - 路由与页面：`/video`、`/edit`、`/history`、`/history/tts`、`/account`
  - 组件：`YtLinkInput`、`VideoCard`、`TextEditor`、`CharCounter`、`VoiceSelector`、`GenerateButton`、`AudioPlayer`
  - API 层：`api/yt.ts`、`api/tts.ts`、`api/history.ts`、`api/account.ts`
  - 文件解析：txt/md 解析与统一字符计数工具
  - 登录交互：手机号登录弹窗、退出

## 1. 路由与页面
- 新增路由：
  - `/video` → `views/Video.vue`
  - `/edit` → `views/Edit.vue`
  - `/history` → `views/History.vue`
  - `/history/tts` → `views/HistoryTTS.vue`
  - `/account` → `views/Account.vue`
- 首页 `views/Home.vue`：增加“文本/文件模式”入口与文件选择解析逻辑。

## 2. 组件实现
- `components/YtLinkInput.vue`：输入与校验（URL/ID）；emit 提交事件
- `components/VideoCard.vue`：缩略图、标题、作者、时长、发布日期、播放量
- `components/TextEditor.vue`：中文可编辑文本域（支持粘贴 txt/md）
- `components/CharCounter.vue`：实时字符数，显示“以服务端为准”提示
- `components/VoiceSelector.vue`：音色选择（默认推荐，简单下拉/卡片二选一）
- `components/GenerateButton.vue`：loading/disabled 态
- `components/AudioPlayer.vue`：播放/暂停、进度、下载、复制链接

## 3. API 与工具
- 新增 `api/yt.ts`：
  - `info(idOrUrl)` → POST `/api/yt/info`
  - `text(idOrUrl)` → POST `/api/yt/text`
- 新增 `api/tts.ts`：`synthesize({ text, speaker })` → POST `/api/tts/synthesize`
- 新增 `api/history.ts`：`listVideos(p)`、`getVideo(site,id)`、`listTTS(p)`
- 新增 `api/account.ts`：`profile()`、`packages()`、`usage(range)`、`login(phone)`、`logout()`
- http 基础封装：带 Cookie；统一错误 toast；loading 标识（可用 axios 拦截器或 fetch 封装）
- 工具：
  - `utils/text.ts`：`normalizeAndCount(text)` 实现统一计数
  - `utils/file.ts`：`parseTxt(file)`、`parseMd(file)`（去 markdown 语法、保留段落）

## 4. 页面逻辑
- Home：
  - `YtLinkInput` 提交 → `api.yt.info` 成功后跳转 `/video?vid=...`
  - 选择 txt/md → 前端读取并解析 → 存 `store` 或路由状态 → 跳转 `/edit`
- Video：
  - 展示 `VideoCard` → 点击“获取文本与音频” → `api.yt.text` → 存 `store` → 跳转 `/edit`
- Edit：
  - 左侧英文只读；右侧中文可编辑（初始来自 `/api/yt/text` 或文件解析）
  - 实时 `CharCounter`；`VoiceSelector`；`GenerateButton` → `api.tts.synthesize` → `AudioPlayer`
- History：
  - 视频历史列表（分页）→ 详情页 `VideoDetail`（可合并为同页抽屉）显示中英/分句/音频直链
  - 合成历史列表（分页）
- Account：
  - 套餐卡片（ASR/TTS 剩余量/总量/有效期）
  - 使用统计（近 30 天）
- 登录/退出：
  - Header 用户菜单 → 登录弹窗（手机号）→ `api.account.login`；退出 → `api.account.logout`

## 5. 状态管理（可选 Pinia）
- userStore：profile
- accountStore：packages、usage
- videoStore：currentVideo、currentTranscript
- ttsStore：lastResult

## 6. 样式规范
- 按文档统一按钮/卡片/表单类名；不提供音频参数选择（后端默认）
- 桌面优先；最小栅格适配；基础 ARIA 标签

## 7. 自测与联调用例
- /api/yt/info → /video 展示正确
- /api/yt/text → /edit 展示 text_en/text_zh/utterances/char_count_zh
- /api/tts/synthesize → 播放器可播放/下载
- txt/md 上传 → 解析正确 → 可合成
- 历史视频/合成列表与详情展示准确
- 账号页：剩余量/统计展示；登录/退出流程通畅

## 8. 交付物
- 页面与组件代码、api 封装、工具、简单 e2e 脚本（可选）
- 接口示例（curl/HTTPie）与 README 更新片段
