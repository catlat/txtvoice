# 综合验收确认（V1）

本文件用于对照《设计与开发方案》《前端/后端开发计划》进行整体验收，包含用例、接口校验与页面核对清单。

## 1. 功能闭环用例
- YouTube 流程：
  1) /api/yt/info → 返回视频信息
  2) /api/yt/text → 返回 text_en/text_zh/utterances/audio、char_count_zh
  3) 前端展示编辑页并可生成音频：/api/tts/synthesize → 返回 audio_url
- 文本/文件模式：
  1) 上传 txt/md → 解析文本 → 编辑页显示 → 生成音频成功

## 2. 页面验收（视觉与交互）
- 首页：链接输入、文件模式入口；错误反馈
- 视频信息：信息展示与“获取文本与音频”按钮
- 编辑与生成：中英展示、字符统计、音色选择、生成按钮、播放器
- 历史：
  - 视频历史列表与详情（中英/分句/音频直链）
  - 合成历史列表（文本预览/字符数/音色/时间）
- 账号：套餐卡片（ASR/TTS 剩余量/总量/有效期）、使用统计（30 天）
- 登录/退出：手机号登录弹窗、退出流程

## 3. 接口与数据校验
- /api/yt/info：必填 `id_or_url`；返回关键字段完整；错误映射 200xx
- /api/yt/text：命中缓存时 `cached=true`；返回 `utterances`、`char_count_en/zh`
- /api/tts/synthesize：默认 mp3@24000；返回 `audio_url` 与 `char_count`
- 历史接口：分页参数与返回字段符合计划；详情聚合准确
- 账号接口：profile/packages/usage 字段齐全；range=30d 零填充
- 登录接口：白名单手机号可登录；Cookie 正常下发与清除

## 4. 计数一致性
- 前端 `normalizeAndCount` 与后端计数结果一致；不一致时 UI 显示“以服务端为准”
- /api/yt/text 的 `char_count_zh` / /api/tts/synthesize 的 `char_count` 与前端对齐

## 5. 数据持久化与历史
- 生成后入库：
  - youtube_video/status、youtube_transcript（含 utterances/char_count）
  - tts_history（text_hash、text_preview、char_count、speaker、audio_url）
- 查询：历史列表与详情可正确读取上述数据

## 6. 错误处理与重试
- dlyt 上游异常（包括 502）→ 200xx BizError 返回；前端提示与重试
- ASR/翻译/TTS 异常 → 210xx/220xx/230xx；前端提示与重试
- 超时与重试策略验证（日志中可见）

## 7. 安全与会话
- 白名单手机号登录；Cookie 为 HTTP Only；退出清除
- /monitor 白名单限制生效

## 8. 性能与稳定（基础）
- /status 健康：DB/Redis 均 OK
- 队列与日志：asynqmon 可访问（白名单 IP）

## 9. 交付清单确认
- 代码与配置（.env 示例）
- 数据库迁移脚本与初始化样例
- 接口示例（Postman/HTTPie/cURL）
- 测试账号（白名单手机号）与演示视频 ID
