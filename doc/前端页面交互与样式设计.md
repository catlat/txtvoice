# 前端页面交互与样式设计（V1）

本设计基于 `页面参考图/` 提供的图片与后端接口方案（/api/yt/info、/api/yt/text、/api/tts/synthesize），目标是快速完成第一版可用界面，强调清晰的信息架构、直观的流程与可扩展样式约定。

## 1. 信息架构与页面

- 首页（模式入口）
  - 区块 A：YouTube 链接输入（参考“视频信息展示参考图.png”）
  - 区块 B：文本/文件模式入口（txt/md 上传，上传后进入编辑与生成页，并将解析出的文本填充到中文编辑框）
  - 最近任务（可选，V1 可隐藏）

- 视频信息页（确认页）
  - 显示：缩略图、标题、作者、时长、发布日期、播放量等（图：视频信息展示参考图.png）
  - 操作：按钮“获取文本与音频” → 请求 `/api/yt/text`

- 编辑与生成页（核心页面）
  - 上方：语言切换与来源信息（图：语言选择参考图.png）
  - 左侧：原文（英文）只读；右侧：中文可编辑输入框（高度自适应）
  - 下方工具栏：
    - 字符统计：显示 `char_count_zh`，与后端计数一致
    - 语音选择（图：声音选择的参考图.png）
    - 生成音频按钮（主按钮）
  - 生成结果区：音频播放器与下载链接（图：音频播放显示参考图.png）
  - 入口：
    - 来自 YouTube 流程（/api/yt/text 返回 `text_en/text_zh`）
    - 来自 文本/文件模式（txt/md 解析后的文本直接填充到中文编辑框）

- 结果页（或同页展示）
  - 播放器组件、文件大小/时长信息、复制链接
  - 可选：返回编辑继续生成

- 历史记录页（列表 + 详情）
  - 视频历史：基于 `youtube_video` 展示 `缩略图/标题/作者/时长/processed_at`，点击进入详情
  - 详情：聚合 `youtube_video + youtube_transcript`，展示中英文本与分句、音频直链
  - 合成历史：基于 `tts_history` 展示 `text_preview/char_count/speaker/created_at`，支持播放与复制链接

- 账号页（套餐与使用）
  - 套餐卡片：展示名称/总量/有效期/剩余量（ASR/TTS 分开）
  - 使用统计：30 天折线图（asr_chars/tts_chars），或列表
  - 入口：导航右上角用户菜单

## 2. 交互流程（YouTube 模式）

1) 首页输入链接 → 点击“获取信息” → 调用 `/api/yt/info` 显示视频信息页
2) 点击“获取文本与音频” → 调用 `/api/yt/text` → 返回 `text_en/text_zh/utterances/audio_url` 等
3) 进入编辑与生成页：
   - 右侧中文文本可编辑；底部显示字符统计（根据“统一字符计费规范”）
   - 选择音色 → 点击“生成音频”（音频参数采用系统默认） → 调用 `/api/tts/synthesize`
4) 展示生成的 `audio_url` 播放器与下载链接

异常与反馈
## 2.1 交互流程（文本/文件模式）

1) 首页选择“文本/文件模式” → 选择本地文件（txt 或 md）
2) 前端读取并解析：
   - txt：按 UTF-8 文本读取
   - md：移除 Markdown 语法标记（保留段落与换行，代码块默认剔除）
   - 归一化：按“统一字符计费规范”进行 NFKC、空白压缩
3) 跳转到“编辑与生成页”，将解析后的文本填入中文编辑框；实时显示字符统计
4) 选择音色 → 点击“生成音频”（参数默认）→ 调用 `/api/tts/synthesize` → 展示播放器

- 接口请求过程中的 Loading/进度提示：
  - /api/yt/text 分阶段提示（已触发下载/转写/翻译或直接命中缓存）
- 错误提示：统一 Toast/Alert 样式；部分错误附带“重试”按钮

## 3. 组件清单（Vue 3 + Tailwind）

- YtLinkInput：链接输入框 + 提交按钮
- VideoCard：视频信息卡片（缩略图/标题/作者/时长/发布日期/播放量）
- LangSwitch：语言显示/切换（中文编辑、英文只读）
- TextEditor：中文可编辑输入框（支持粘贴 txt/md 自动清洗）
- CharCounter：显示字符数与计费提示
- VoiceSelector：音色选择（下拉/卡片）
- GenerateButton：生成按钮（带 Loading 与禁用态）
- AudioPlayer：音频播放器（进度、下载、复制链接）

## 4. 样式规范（Tailwind）

- 色彩（参考图风格）：
  - 主色：`bg-gray-800` 导航；文本 `text-gray-900` 主标题，`text-gray-600` 副文本
  - 交互主按钮：`bg-indigo-600 hover:bg-indigo-700 text-white`
  - 卡片：`bg-white shadow rounded-lg p-4`

- 排版：
  - 页面容器：`max-w-screen-xl mx-auto px-4 sm:px-6 lg:px-8`
  - 表单控件：`rounded-md border border-gray-300 focus:ring-indigo-500 focus:border-indigo-500`
  - 栅格布局：编辑页采用两栏 `grid grid-cols-1 lg:grid-cols-2 gap-6`

- 表单与按钮：
  - 主按钮：`inline-flex items-center px-4 py-2 rounded-md bg-indigo-600 text-white hover:bg-indigo-700 disabled:opacity-60`
  - 次按钮/链接：`text-indigo-600 hover:text-indigo-700`

## 5. 字符计数一致性

- 前端实现：
  - NFKC 归一化 → 去首尾空白 → 连续空白压缩为单空格 → 统计非空白字符
- 触发点：
  - 文本变化时实时显示；提交 `/api/tts/synthesize` 前再次以相同算法计算
- 对账：
  - 服务端返回 `char_count`，前端显示并与本地计算值一致（若不一致，显示“以服务端为准”）

## 6. 页内关键交互细节

- 语音选择：
  - 默认选中推荐音色；展开后可切换，支持关键字搜索（V1 可不做搜索）
- 分句展示：
  - `utterances` 可选启用，采用折叠面板展示句级时间戳，便于定位与编辑
- 音频播放器：
  - 进度条、播放/暂停、时间码；下载按钮与复制直链
 - 生成音频：
   - 音频参数默认：`format=mp3`, `sample_rate=24000`；前端不提供选择器，后端统一默认与计费。

- 登录与退出：
  - 顶部导航右侧用户菜单：未登录显示“登录”，弹出手机号输入框；登录后显示 `display_name` 与“退出”
  - 登录：调用 `/api/auth/login_simple`，成功后刷新 `profile`/`packages`/`usage`
  - 退出：调用 `/api/auth/logout`，清除本地用户态并回到首页

## 7. 适配说明（桌面优先）

- 不进行移动端专项适配，仅做最小样式兼容：
  - 容器保持 `max-w-screen-xl`，小屏时栅格从 2 列降为 1 列
  - 控件尺寸与交互按桌面标准，不做触摸态优化
  - 保留基础无障碍：`aria-label` 与对比度

## 8. 接口对齐与数据绑定

- /api/yt/info → `VideoCard`
- /api/yt/text → `TextEditor`（text_zh）、`CharCounter`（char_count_zh）、`AudioPlayer`（audio.audio_url）、`utterances`
- /api/tts/synthesize → `AudioPlayer`（返回的 tts 音频直链），仅传 `text`、`speaker`，音频参数为后端默认
- /api/history/videos → 历史视频列表（表格/卡片）
- /api/history/video/{source_site}/{video_id} → 历史视频详情（聚合信息）
- /api/history/tts → 合成历史列表
 - /api/account/profile → 用户信息（phone/display_name）
 - /api/account/packages → 套餐与剩余量（asr/tts）
 - /api/account/usage → 使用统计（daily）
 - /api/auth/login_simple、/api/auth/logout → 登录/退出

## 9. 首版完成定义（DoD）

- 链接→信息→文本→生成→播放 全链路打通
- 统一字符计数逻辑前后端一致，且在 UI 清晰展示
- 常见错误与进度提示；基本响应式布局
- 样式与交互符合参考图意图，细节允许近似处理


